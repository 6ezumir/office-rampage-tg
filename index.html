<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <title>Office Rampage</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #1a1a2e;
            touch-action: manipulation;
            -webkit-user-select: none;
            user-select: none;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        #game-container {
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
        }
        
        /* –ó–ê–ì–†–£–ó–û–ß–ù–´–ô –≠–ö–†–ê–ù */
        #loading-screen {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 1000;
            padding: 20px;
            text-align: center;
        }
        
        .loading-logo {
            font-size: 3em;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }
        
        .loading-bar {
            width: 200px;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .loading-progress {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            width: 0%;
            border-radius: 4px;
            transition: width 0.3s;
        }
        
        /* –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ */
        #main-menu {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(135deg, #0f3460 0%, #1a1a2e 100%);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 900;
            padding: 20px;
        }
        
        .game-title {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
            background: linear-gradient(45deg, #3498db, #9b59b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .game-subtitle {
            font-size: 1em;
            opacity: 0.7;
            margin-bottom: 40px;
            text-align: center;
        }
        
        .menu-button {
            width: 80%;
            max-width: 300px;
            padding: 18px 25px;
            margin: 10px 0;
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        
        .menu-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(52, 152, 219, 0.4);
        }
        
        .menu-button:active {
            transform: translateY(-2px);
        }
        
        .menu-button.secondary {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            box-shadow: 0 8px 20px rgba(46, 204, 113, 0.3);
        }
        
        .menu-button.danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.3);
        }
        
        .player-info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.1);
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 0.9em;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* –î–ª—è iOS Safari */
        @supports (-webkit-touch-callout: none) {
            body {
                height: -webkit-fill-available;
            }
        }
    </style>
</head>
<body>
    <!-- –ó–ê–ì–†–£–ó–û–ß–ù–´–ô –≠–ö–†–ê–ù -->
    <div id="loading-screen">
        <div class="loading-logo">üè¢</div>
        <h1 style="font-size: 2em; margin-bottom: 10px;">OFFICE RAMPAGE</h1>
        <p style="opacity: 0.7; margin-bottom: 30px;">–ì–æ—Ç–æ–≤–∏–º –æ—Ñ–∏—Å –∫ —Ä–∞–∑—Ä—É—à–µ–Ω–∏—é...</p>
        
        <div class="loading-bar">
            <div class="loading-progress" id="loading-progress"></div>
        </div>
        
        <p id="loading-text" style="margin-top: 20px; font-size: 0.9em;">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã...</p>
    </div>
    
    <!-- –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ -->
    <div id="main-menu">
        <div class="player-info" id="player-info" style="display: none;">
            üë§ <span id="player-name">–ò–≥—Ä–æ–∫</span>
        </div>
        
        <div class="game-title">OFFICE RAMPAGE</div>
        <div class="game-subtitle">–†–∞–∑—Ä—É—à–∞–π –æ—Ñ–∏—Å —Å —É–º–æ–º!</div>
        
        <button class="menu-button" onclick="startGame()">
            üéÆ –ù–ê–ß–ê–¢–¨ –ò–ì–†–£
        </button>
        
        <button class="menu-button secondary" onclick="showInstructions()">
            üìñ –ö–ê–ö –ò–ì–†–ê–¢–¨
        </button>
        
        <button class="menu-button" onclick="showLeaderboard()">
            üèÜ –¢–ê–ë–õ–ò–¶–ê –õ–ò–î–ï–†–û–í
        </button>
        
        <button class="menu-button" onclick="showSettings()">
            ‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò
        </button>
        
        <div style="margin-top: 40px; font-size: 0.8em; opacity: 0.5; text-align: center;">
            <p>–¢–∞–ø–∞–π –æ–±—ä–µ–∫—Ç—ã —á—Ç–æ–±—ã –≤–∑—è—Ç—å</p>
            <p>–î–≤–æ–π–Ω–æ–π —Ç–∞–ø —á—Ç–æ–±—ã —É–¥–∞—Ä–∏—Ç—å</p>
            <p>–ù–∞–±–µ—Ä–∏ –º–∞–∫—Å–∏–º—É–º –æ—á–∫–æ–≤!</p>
        </div>
    </div>
    
    <!-- –ò–ì–†–ê -->
    <div id="game-container"></div>
    
    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <script src="telegram.js"></script>
    <script src="game.js"></script>
    
    <script>
        // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
        let gameInstance = null;
        let playerName = '–ò–≥—Ä–æ–∫';
        let bestScore = localStorage.getItem('office_rampage_best') || 0;
        
        // –ó–ê–ì–†–£–ó–û–ß–ù–´–ô –ü–†–û–¶–ï–°–°
        const loadingTexts = [
            '–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã...',
            '–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ—Ñ–∏—Å...',
            '–ì–æ—Ç–æ–≤–∏–º –ø—Ä–∏–Ω—Ç–µ—Ä—ã...',
            '–ó–∞–≤–∞—Ä–∏–≤–∞–µ–º –∫–æ—Ñ–µ...',
            '–í–∫–ª—é—á–∞–µ–º –≥–Ω–µ–≤...',
            '–í—Å—ë –≥–æ—Ç–æ–≤–æ!'
        ];
        
        let loadingStep = 0;
        const loadingProgress = document.getElementById('loading-progress');
        const loadingText = document.getElementById('loading-text');
        
        function updateLoading() {
            loadingStep++;
            const progress = Math.min(100, (loadingStep / loadingTexts.length) * 100);
            loadingProgress.style.width = progress + '%';
            loadingText.textContent = loadingTexts[loadingStep - 1] || '–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ...';
            
            if (loadingStep <= loadingTexts.length) {
                setTimeout(updateLoading, 500 + Math.random() * 300);
            } else {
                // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
                setTimeout(() => {
                    document.getElementById('loading-screen').style.display = 'none';
                    showMainMenu();
                }, 500);
            }
        }
        
        // –ü–û–ö–ê–ó–ê–¢–¨ –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ
        function showMainMenu() {
            const menu = document.getElementById('main-menu');
            const playerInfo = document.getElementById('player-info');
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å Telegram, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–º—è –∏–≥—Ä–æ–∫–∞
            if (window.TelegramApp && TelegramApp.userName) {
                playerName = TelegramApp.userName;
                document.getElementById('player-name').textContent = playerName;
                playerInfo.style.display = 'block';
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª—É—á—à–∏–π —Å—á—ë—Ç
            if (bestScore > 0) {
                document.querySelector('.game-subtitle').innerHTML = 
                    `–†–∞–∑—Ä—É—à–∞–π –æ—Ñ–∏—Å —Å —É–º–æ–º!<br><small>üèÜ –õ—É—á—à–∏–π —Å—á—ë—Ç: ${bestScore}</small>`;
            }
            
            menu.style.display = 'flex';
            setTimeout(() => {
                menu.style.animation = 'fadeIn 0.5s ease-out';
            }, 10);
        }
        
        // –ù–ê–ß–ê–¢–¨ –ò–ì–†–£
        function startGame() {
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
            
            // –ï—Å–ª–∏ –∏–≥—Ä–∞ —É–∂–µ –∑–∞–ø—É—â–µ–Ω–∞, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º
            if (gameInstance) {
                gameInstance.destroy(true);
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É
            initializeGame();
        }
        
        // –í–ï–†–ù–£–¢–¨–°–Ø –í –ú–ï–ù–Æ
        function returnToMenu() {
            if (gameInstance) {
                gameInstance.destroy(true);
                gameInstance = null;
            }
            
            document.getElementById('game-container').style.display = 'none';
            showMainMenu();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ª—É—á—à–∏–π —Å—á—ë—Ç
            const currentScore = window.gameScore || 0;
            if (currentScore > bestScore) {
                bestScore = currentScore;
                localStorage.setItem('office_rampage_best', bestScore);
            }
        }
        
        // –ò–ù–°–¢–†–£–ö–¶–ò–ò
        function showInstructions() {
            alert(`
üéÆ –ö–ê–ö –ò–ì–†–ê–¢–¨:

1. üëÜ –¢–ê–ü–ù–ò –û–ë–™–ï–ö–¢ - –≤–∑—è—Ç—å –µ–≥–æ
2. üëÜüëÜ –î–í–û–ô–ù–û–ô –¢–ê–ü - —É–¥–∞—Ä–∏—Ç—å –æ–±—ä–µ–∫—Ç
3. üìç –¢–ê–ü–ù–ò –ù–ê –ü–£–°–¢–û–¢–£ - –ø–æ–π—Ç–∏ —Ç—É–¥–∞
4. üëä –ö–ù–û–ü–ö–ê "–£–î–ê–†" - —É–¥–∞—Ä–∏—Ç—å –±–ª–∏–∂–∞–π—à–∏–π –æ–±—ä–µ–∫—Ç
5. ‚òï –ö–ù–û–ü–ö–ê "–ö–û–§–ï" - —Å–Ω—è—Ç—å —Å—Ç—Ä–µ—Å—Å (-20%)
6. üò° –ö–ù–û–ü–ö–ê "–ì–ù–ï–í" - —É–≤–µ–ª–∏—á–∏—Ç—å —Å—Ç—Ä–µ—Å—Å (+30%)

üéØ –¶–ï–õ–¨:
- –†–∞–∑—Ä—É—à–∏—Ç—å –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã –≤ –æ—Ñ–∏—Å–µ
- –ù–∞–±—Ä–∞—Ç—å –º–∞–∫—Å–∏–º—É–º –æ—á–∫–æ–≤
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å —Å—Ç—Ä–µ—Å—Å–∞

–£–¥–∞—á–∏! üè¢üí•
            `);
        }
        
        // –¢–ê–ë–õ–ò–¶–ê –õ–ò–î–ï–†–û–í
        function showLeaderboard() {
            const scores = JSON.parse(localStorage.getItem('office_rampage_scores') || '[]');
            
            let leaderboardText = 'üèÜ –¢–ê–ë–õ–ò–¶–ê –õ–ò–î–ï–†–û–í:\n\n';
            
            if (scores.length === 0) {
                leaderboardText += '–ü–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–µ –∏–≥—Ä–∞–ª!\n–ë—É–¥—å –ø–µ—Ä–≤—ã–º!';
            } else {
                scores.sort((a, b) => b.score - a.score).slice(0, 10).forEach((entry, i) => {
                    leaderboardText += `${i + 1}. ${entry.player}: ${entry.score} –æ—á–∫–æ–≤\n`;
                });
            }
            
            leaderboardText += '\n\n–¢–≤–æ–π –ª—É—á—à–∏–π —Å—á—ë—Ç: ' + bestScore;
            
            alert(leaderboardText);
        }
        
        // –ù–ê–°–¢–†–û–ô–ö–ò
        function showSettings() {
            const soundEnabled = localStorage.getItem('office_rampage_sound') !== 'false';
            const vibrationEnabled = localStorage.getItem('office_rampage_vibration') !== 'false';
            
            const settings = `
‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò:

üîä –ó–≤—É–∫: ${soundEnabled ? '–í–ö–õ' : '–í–´–ö–õ'}
üì≥ –í–∏–±—Ä–∞—Ü–∏—è: ${vibrationEnabled ? '–í–ö–õ' : '–í–´–ö–õ'}

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
            `;
            
            if (confirm(settings + '\n\n–•–æ—á–µ—à—å –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏?')) {
                localStorage.setItem('office_rampage_sound', !soundEnabled);
                localStorage.setItem('office_rampage_vibration', !vibrationEnabled);
                alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!');
            }
        }
        
        // –ù–ê–ß–ê–¢–¨ –ó–ê–ì–†–£–ó–ö–£
        setTimeout(updateLoading, 1000);
        
        // –ë–ª–æ–∫–∏—Ä—É–µ–º –∑—É–º –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
        document.addEventListener('touchmove', function(e) {
            if(e.scale !== 1) e.preventDefault();
        }, { passive: false });
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏–≥—Ä—ã
        window.returnToMenu = returnToMenu;
        window.playerName = playerName;
    </script>
</body>
</html>
